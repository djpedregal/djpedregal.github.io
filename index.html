<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Use UComp!</title>

<script src="site_libs/jquery-1.11.3/jquery.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/united.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<link href="site_libs/highlightjs-9.12.0/textmate.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>

<style type="text/css">code{white-space: pre;}</style>
<style type="text/css">
  pre:not([class]) {
    background-color: white;
  }
</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>



<style type="text/css">
h1 {
  font-size: 34px;
}
h1.title {
  font-size: 38px;
}
h2 {
  font-size: 30px;
}
h3 {
  font-size: 24px;
}
h4 {
  font-size: 18px;
}
h5 {
  font-size: 16px;
}
h6 {
  font-size: 12px;
}
.table th:not([align]) {
  text-align: left;
}
</style>




<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
code {
  color: inherit;
  background-color: rgba(0, 0, 0, 0.04);
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
</style>


<style type="text/css">
/* padding for bootstrap navbar */
body {
  padding-top: 51px;
  padding-bottom: 40px;
}
/* offset scroll position for anchor links (for fixed navbar)  */
.section h1 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h2 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h3 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h4 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h5 {
  padding-top: 56px;
  margin-top: -56px;
}
.section h6 {
  padding-top: 56px;
  margin-top: -56px;
}
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #ffffff;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script>
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.parent().addClass('active');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  background: white;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->




</head>

<body>


<div class="container-fluid main-container">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Use Ucomp!</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">Home</a>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div class="fluid-row" id="header">



<h1 class="title toc-ignore">Use UComp!</h1>

</div>


<p>Here there are some examples run with package <strong>UComp</strong>, for the automatic modelling of Unobserved Components models <em>a la</em> Harvey (1989). The absolute novelty of this package is that it provides an automatic identification of UC models, though particular models may be estimated, if desired. The package also perform outlier detection, may identify cycles of period longer than one year and allows for models with exogenous inputs.</p>
<p>The library is composed of just a few functions to perform a comprehensive analysis of time series:</p>
<ul>
<li>UC: runs everything</li>
<li>UCsetup: creates <strong>UComp</strong> objects</li>
<li>UCmodel: runs UCsetup, estimates/identifies model and produce forecasts</li>
<li>UCvalidate: runs diagnositics checks and show estimation table</li>
<li>UCfilter: filters the data and computes states and their covariance matrices</li>
<li>UCsmooth: as UCfilter, but smoothing the data</li>
<li>UCdisturb: runs the disturbance smoother</li>
<li>UCcomponents: estimate components (trend, seasonal, irregular, etc.)</li>
</ul>
<p>The inputs to UC, UCsetup and UCmodel are the same and control how the rest of functions work (check the manual and examples below).</p>
<p>Now, the examples. First, just load the library and some data (monthly Spanish industrial production index) from January 2000 to December 2019. the last year of data is reserved to check forecasting performance.</p>
<pre class="r"><code>library(UComp)</code></pre>
<pre><code>## Loading required package: Rcpp</code></pre>
<pre class="r"><code>load(url(&quot;https://github.com/djpedregal/djpedregal.github.io/blob/master/ipi.Rdata?raw=true&quot;))
ipi = ts(y[1 : 208], start = 2000, frequency = 12)
plot(ipi)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-1-1.png" width="672" /></p>
<p>The call could be as simple as the next to estimate the optimal model and plot the components. The output shows the estimated models with their information criteria values and the table with the estimates and some diagnostics tests.</p>
<pre class="r"><code>m = UC(log(ipi))</code></pre>
<pre><code>## ------------------------------------------------------------
##  Identification started WITHOUT outlier detection
## ------------------------------------------------------------
##           Model                       AIC      BIC     AICc
## ------------------------------------------------------------
##        none/none/none/arma(0,0):  -0.8407  -0.8247  -0.8407
##            none/none/equal/none:   1.2222   1.4147   1.2270
##       none/none/equal/arma(0,0):  -0.7102  -0.5016  -0.7054
##        none/none/different/none:  -1.1573  -0.8845  -1.1429
##   none/none/different/arma(0,0):   0.4555   0.7444   0.4700
##               rw/none/none/none:  -0.8572  -0.8412  -0.8572
##          rw/none/none/arma(0,0):  -1.5203  -1.4882  -1.5203
##              rw/none/equal/none:  -2.5545  -2.3459  -2.5497
##         rw/none/equal/arma(0,0):  -2.7475  -2.5229  -2.7379
##          rw/none/different/none:  -2.7614  -2.4726  -2.7470
##     rw/none/different/arma(0,0):  -2.7822  -2.4773  -2.7630
##              llt/none/none/none:  -0.7945  -0.7464  -0.7945
##         llt/none/none/arma(0,0):  -1.4430  -1.3788  -1.4430
##             llt/none/equal/none:  -2.4688  -2.2281  -2.4591
##        llt/none/equal/arma(0,0):  -2.6311  -2.3744  -2.6215
##         llt/none/different/none:  -2.6807  -2.3598  -2.6615
##    llt/none/different/arma(0,0):  -2.7040  -2.3670  -2.6847
##               dt/none/none/none:  -0.8208  -0.7727  -0.8208
##          dt/none/none/arma(0,0):  -1.4749  -1.4107  -1.4749
##              dt/none/equal/none:  -2.5232  -2.2825  -2.5136
##         dt/none/equal/arma(0,0):  -2.6026  -2.3459  -2.5930
##          dt/none/different/none:  -2.7054  -2.3845  -2.6862
##     dt/none/different/arma(0,0):  -2.7569  -2.4200  -2.7377
## ------------------------------------------------------------
##   Identification time:    1.81076 seconds
## ------------------------------------------------------------
## -------------------------------------------------------------
##   Concentrated Maximum-Likelihood
##   Model: rw/none/different/arma(0,0)
##   Periods:  12.0 /  6.0 /  4.0 /  3.0 /  2.4 /  2.0
##   Q-Newton: Function convergence
##   (*)  concentrated out parameter
##  -------------------------------------------------------------
##                       Param          |T|    P-value     |Grad| 
##  -------------------------------------------------------------
##         Level:     2.01e-04          nan        nan   4.13e-05
##    Seas(12.0):     9.03e-07          nan        nan   2.60e-05
##     Seas(6.0):     1.56e-06          nan        nan   2.36e-05
##     Seas(4.0):     1.76e-06          nan        nan   2.64e-05
##     Seas(3.0):     5.32e-05          nan        nan   3.85e-05
##     Seas(2.4):     2.14e-05          nan        nan   2.99e-05
##     Seas(2.0):     6.40e-07          nan        nan   2.21e-05
##     Irregular:     3.45e-04*         nan        nan        nan
##  -------------------------------------------------------------
##    AIC:      -2.7822   BIC:      -2.4773   AICc:      -2.7630
##             Log-Likelihood:     308.3510
##  -------------------------------------------------------------
##     Summary statistics:
##  -------------------------------------------------------------
##          Missing data:      
##          Q( 1):       0.8665         Q( 4):       4.9369
##          Q( 8):      11.7859         Q(12):      17.5830
##    Bera-Jarque:      24.2265       P-value:       0.0000
##        H(  66):       0.9878       P-value:       0.9605
##    Outliers (&gt;2.7 ES):     4
##          Q( 1):       1.7276         Q( 4):       6.1233
##          Q( 8):       9.4265         Q(12):      28.7418
##    Bera-Jarque:       1.0223       P-value:       0.5998
##        H(  66):       0.8960       P-value:       0.6569
##  -------------------------------------------------------------
## </code></pre>
<pre class="r"><code>plot(m$comp)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-2-1.png" width="672" /></p>
<p>A different call, more complex, would be as follows (just one model is estimated, the forecasting horizon is fixed at 24 months, verbose output is avoided, see the full set of options in the documentation). As can be easily seen, the diagnostics tests indicate that this model is completely inappropriate:</p>
<pre class="r"><code>m = UC(log(ipi), model = &quot;rw/equal/arma(0,0)&quot;, h = 24, verbose = FALSE)</code></pre>
<pre><code>## -------------------------------------------------------------
##   Concentrated Maximum-Likelihood
##   Model: rw/none/equal/arma(0,0)
##   Periods:  12.0 /  6.0 /  4.0 /  3.0 /  2.4 /  2.0
##   Q-Newton: Function convergence
##   (*)  concentrated out parameter
##  -------------------------------------------------------------
##                       Param          |T|    P-value     |Grad| 
##  -------------------------------------------------------------
##         Level:     1.89e-04          nan        nan   1.05e-05
##     Seas(All):     8.36e-07          nan        nan   7.08e-06
##     Irregular:       0.0011*         nan        nan        nan
##  -------------------------------------------------------------
##    AIC:      -2.7475   BIC:      -2.5229   AICc:      -2.7379
##             Log-Likelihood:     299.7431
##  -------------------------------------------------------------
##     Summary statistics:
##  -------------------------------------------------------------
##          Missing data:      
##          Q( 1):       6.4970         Q( 4):      27.1963
##          Q( 8):      41.5867         Q(12):      73.1916
##    Bera-Jarque:       6.8197       P-value:       0.0330
##        H(  66):       0.9540       P-value:       0.8488
##    Outliers (&gt;2.7 ES):     4
##          Q( 1):       8.1112         Q( 4):      19.7049
##          Q( 8):      27.2471         Q(12):      76.9467
##    Bera-Jarque:       0.4328       P-value:       0.8054
##        H(  66):       0.8748       P-value:       0.5883
##  -------------------------------------------------------------
## </code></pre>
<p>Something that is very interesting in this case is the estimation with Easter and calendar effects (already loaded in matrix u) and with outlier detection. Check out the diagnostics and now to see that this model is much more adequate:</p>
<pre class="r"><code>m = UC(log(ipi), u = u, outlier = 4)</code></pre>
<pre><code>## ------------------------------------------------------------
##  Identification started WITH outlier detection
## ------------------------------------------------------------
##           Model                       AIC      BIC     AICc
## ------------------------------------------------------------
##        none/none/none/arma(0,0):   5.8721   5.9041   5.8721
##            none/none/equal/none:   7.5297   7.7383   7.5345
##       none/none/equal/arma(0,0):  -0.6501  -0.4094  -0.6405
##        none/none/different/none:  -1.3761  -1.0713  -1.3569
##   none/none/different/arma(0,0):   0.5289   0.8498   0.5481
##               rw/none/none/none:   4.3441   4.3922   4.3441
##          rw/none/none/arma(0,0):  -1.8637  -1.6551  -1.8588
##              rw/none/equal/none:  -3.8845  -3.6277  -3.8749
##         rw/none/equal/arma(0,0):  -3.9097  -3.6369  -3.8953
##          rw/none/different/none:  -3.8561  -3.5191  -3.8369
##     rw/none/different/arma(0,0):  -3.8736  -3.5206  -3.8496
##              llt/none/none/none:  -0.7858  -0.7056  -0.7858
##         llt/none/none/arma(0,0):  -1.8302  -1.5734  -1.8206
##             llt/none/equal/none:  -3.7546  -3.4818  -3.7402
##        llt/none/equal/arma(0,0):  -3.7761  -3.4713  -3.7569
##         llt/none/different/none:  -3.7241  -3.3711  -3.7000
##    llt/none/different/arma(0,0):  -3.7274  -3.3423  -3.6985
##               dt/none/none/none:  -0.8115  -0.7313  -0.8115
##          dt/none/none/arma(0,0):  -1.7716  -1.5469  -1.7619
##              dt/none/equal/none:  -3.8292  -3.5404  -3.8148
##         dt/none/equal/arma(0,0):  -3.8546  -3.5497  -3.8353
##          dt/none/different/none:  -3.8007  -3.4317  -3.7719
##     dt/none/different/arma(0,0):  -3.8254  -3.4403  -3.7966
## ------------------------------------------------------------
##   Identification time:    9.28477 seconds
## ------------------------------------------------------------
## -------------------------------------------------------------
##   Concentrated Maximum-Likelihood
##   Model: rw/none/equal/arma(0,0) + inputs
##   Periods:  12.0 /  6.0 /  4.0 /  3.0 /  2.4 /  2.0
##   Q-Newton: Function convergence
##   (*)  concentrated out parameter
##  -------------------------------------------------------------
##                       Param          |T|    P-value     |Grad| 
##  -------------------------------------------------------------
##         Level:     1.20e-04*         nan        nan        nan
##     Seas(All):     1.21e-06       9.9135     0.0000   1.25e-05
##     Irregular:     8.15e-05       0.7123     0.4771   1.66e-05
##       Beta(1):      -0.0807      16.3866     0.0000   0.00e+00
##       Beta(2):       0.0080      21.0155     0.0000   0.00e+00
##         LS108:      -0.1008       5.6277     0.0000   0.00e+00
##  -------------------------------------------------------------
##    AIC:      -3.9097   BIC:      -3.6369   AICc:      -3.8953
##             Log-Likelihood:     423.6118
##  -------------------------------------------------------------
##     Summary statistics:
##  -------------------------------------------------------------
##          Missing data:      
##          Q( 1):       0.0714         Q( 4):       0.8036
##          Q( 8):       7.5238         Q(12):       9.9888
##    Bera-Jarque:       4.1827       P-value:       0.1235
##        H(  66):       0.9586       P-value:       0.8641
##    Outliers (&gt;2.7 ES):     3
##          Q( 1):       0.2998         Q( 4):       1.6344
##          Q( 8):       6.1335         Q(12):       8.7076
##    Bera-Jarque:       0.1979       P-value:       0.9058
##        H(  66):       0.9586       P-value:       0.8641
##  -------------------------------------------------------------
## </code></pre>
<pre class="r"><code>plot(m$comp)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-4-1.png" width="672" /></p>
<p><em>Beta(1)</em> and <em>Beta(2)</em> are the parameter estimates for Easter and the calendar effects and there is one oulier detected in observations 108 as a level shift.</p>
<p>Finally, forecasts and their variances are stored in fields yFor and yForV, respectively. The following plot shows forecasts and their 95% confidence bands.</p>
<pre class="r"><code>plot(m$yFor, ylim = c(4.3, 4.85))
lines(m$yFor + 2 * sqrt(m$yForV), col = &quot;red&quot;)
lines(m$yFor - 2 * sqrt(m$yForV), col = &quot;red&quot;)</code></pre>
<p><img src="index_files/figure-html/unnamed-chunk-5-1.png" width="672" /></p>




</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.header').parent('thead').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open')
  });
});
</script>

<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
